{"asctime": "2025-07-18 16:52:00,291", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [DELETE] Delete company: LNV-02"}
{"asctime": "2025-07-18 16:52:00,846", "levelname": "INFO", "name": "service.company", "message": "\u2705 Company deleted: LNV-02"}
{"asctime": "2025-07-22 21:24:14,588", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2025-07-22 21:24:15,348", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 3 companies"}
{"asctime": "2025-08-04 20:55:45,095", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2025-08-04 20:55:45,739", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 3 companies"}
{"asctime": "2025-08-04 20:56:05,727", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read company by code: LNV"}
{"asctime": "2025-08-04 20:56:06,431", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved company: LNV"}
{"asctime": "2025-10-16 06:02:09,321", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2025-10-16 06:02:10,172", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 4 companies"}
{"asctime": "2025-11-07 15:12:16,794", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2025-11-07 15:12:18,362", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 4 companies"}
{"asctime": "2025-11-12 14:58:18,718", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2025-11-12 14:58:20,039", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 4 companies"}
{"asctime": "2025-11-12 16:45:30,979", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2025-11-12 16:45:31,395", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 4 companies"}
{"asctime": "2025-11-12 16:53:04,717", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2025-11-12 16:53:05,618", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 4 companies"}
{"asctime": "2025-11-20 14:37:48,764", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2025-11-20 14:37:50,051", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 4 companies"}
{"asctime": "2025-11-20 14:39:04,895", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read company by code: LNV"}
{"asctime": "2025-11-20 14:39:05,381", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved company: LNV"}
{"asctime": "2025-11-20 14:39:53,088", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [DELETE] Delete company: a"}
{"asctime": "2025-11-20 14:39:53,459", "levelname": "WARNING", "name": "service.company", "message": "\u26a0\ufe0f Cannot delete. Company not found: a"}
{"asctime": "2025-12-08 22:12:47,203", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2025-12-08 22:12:48,895", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 4 companies"}
{"asctime": "2025-12-19 20:55:09,630", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2025-12-19 20:55:10,592", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 4 companies"}
{"asctime": "2026-01-10 11:35:39,553", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2026-01-10 11:35:40,696", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 4 companies"}
{"asctime": "2026-01-15 13:52:57,628", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2026-01-15 13:52:59,226", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 4 companies"}
{"asctime": "2026-01-15 14:14:59,914", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2026-01-15 14:15:00,906", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 4 companies"}
{"asctime": "2026-01-15 14:15:55,910", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read company by code: lnv"}
{"asctime": "2026-01-15 14:15:56,506", "levelname": "WARNING", "name": "service.company", "message": "\u26a0\ufe0f Company not found for code: lnv"}
{"asctime": "2026-01-15 14:16:06,075", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read company by code: LNV"}
{"asctime": "2026-01-15 14:16:06,254", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved company: LNV"}
{"asctime": "2026-01-15 14:39:07,865", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [POST] Create company request received: LNL"}
{"asctime": "2026-01-15 14:39:09,297", "levelname": "INFO", "name": "service.company", "message": "\u2705 Company created: LNL"}
{"asctime": "2026-01-15 14:42:44,177", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [POST] Create company request received: LNS"}
{"asctime": "2026-01-15 14:42:45,130", "levelname": "INFO", "name": "service.company", "message": "\u2705 Company created: LNS"}
{"asctime": "2026-01-15 14:46:14,702", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [POST] Create company request received: LNP"}
{"asctime": "2026-01-15 14:46:15,418", "levelname": "INFO", "name": "service.company", "message": "\u2705 Company created: LNP"}
{"asctime": "2026-01-15 14:56:09,620", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [POST] Create company request received: ANP"}
{"asctime": "2026-01-15 14:56:10,817", "levelname": "INFO", "name": "service.company", "message": "\u2705 Company created: ANP"}
{"asctime": "2026-01-15 15:03:12,284", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [POST] Create company request received: BNP"}
{"asctime": "2026-01-15 15:03:13,062", "levelname": "INFO", "name": "service.company", "message": "\u2705 Company created: BNP"}
{"asctime": "2026-01-15 15:06:22,767", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [PUT] Update company: ANP"}
{"asctime": "2026-01-15 15:06:24,212", "levelname": "INFO", "name": "service.company", "message": "\u2705 Company updated: ANP"}
{"asctime": "2026-01-15 15:13:58,582", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [DELETE] Delete company: ANP"}
{"asctime": "2026-01-15 15:13:59,047", "levelname": "INFO", "name": "service.company", "message": "\u2705 Company deleted: ANP"}
{"asctime": "2026-01-15 15:14:04,882", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [DELETE] Delete company: BNP"}
{"asctime": "2026-01-15 15:14:05,292", "levelname": "INFO", "name": "service.company", "message": "\u2705 Company deleted: BNP"}
{"asctime": "2026-01-15 15:14:18,112", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [DELETE] Delete company: LNL"}
{"asctime": "2026-01-15 15:14:18,544", "levelname": "INFO", "name": "service.company", "message": "\u2705 Company deleted: LNL"}
{"asctime": "2026-01-15 15:14:26,093", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [DELETE] Delete company: LNS"}
{"asctime": "2026-01-15 15:14:26,230", "levelname": "INFO", "name": "service.company", "message": "\u2705 Company deleted: LNS"}
{"asctime": "2026-01-15 15:14:45,041", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [DELETE] Delete company: LNP"}
{"asctime": "2026-01-15 15:14:45,218", "levelname": "INFO", "name": "service.company", "message": "\u2705 Company deleted: LNP"}
{"asctime": "2026-01-15 15:15:11,469", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [DELETE] Delete company: LNV"}
{"asctime": "2026-01-15 15:15:11,657", "levelname": "ERROR", "name": "service.company", "message": "\u274c Exception in delete_company: {'code': '23503', 'details': 'Key (company_code)=(LNV) is still referenced from table \"groups\".', 'hint': None, 'message': 'update or delete on table \"companies\" violates foreign key constraint \"fk_groups_company_code\" on table \"groups\"'}"}
{"asctime": "2026-01-15 15:15:35,751", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [DELETE] Delete company: LNV-01"}
{"asctime": "2026-01-15 15:15:35,935", "levelname": "INFO", "name": "service.company", "message": "\u2705 Company deleted: LNV-01"}
{"asctime": "2026-01-15 15:15:43,401", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [DELETE] Delete company: LNV-02"}
{"asctime": "2026-01-15 15:15:43,717", "levelname": "WARNING", "name": "service.company", "message": "\u26a0\ufe0f Cannot delete. Company not found: LNV-02"}
{"asctime": "2026-01-15 15:15:52,510", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [DELETE] Delete company: LNV-03"}
{"asctime": "2026-01-15 15:15:52,816", "levelname": "INFO", "name": "service.company", "message": "\u2705 Company deleted: LNV-03"}
{"asctime": "2026-01-17 17:19:46,279", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [POST] Create company request received: string"}
{"asctime": "2026-01-17 17:19:47,025", "levelname": "ERROR", "name": "service.company", "message": "\u274c Exception in create_company: {'code': '23514', 'details': 'Failing row contains (string, string, string, string, string, string, string, string, string, string, string, string, string, string, string, string, 0.00, string, t, t, 2026-01-17 10:19:47.177229+00, string, 2026-01-17 10:19:47.177229+00, string).', 'hint': None, 'message': 'new row for relation \"companies\" violates check constraint \"ckc_company_type_companies\"'}"}
{"asctime": "2026-01-17 17:19:56,203", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2026-01-17 17:19:56,359", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 2 companies"}
{"asctime": "2026-01-17 17:35:24,436", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2026-01-17 17:35:26,241", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 2 companies"}
{"asctime": "2026-01-17 20:23:33,079", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Read all companies"}
{"asctime": "2026-01-17 20:23:33,686", "levelname": "INFO", "name": "service.company", "message": "\u2705 Retrieved 2 companies"}
{"asctime": "2026-02-08 19:11:52,258", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Search companies | filters={'q': 'Jaruwan', 'is_active': True} | limit=50 offset=0"}
{"asctime": "2026-02-08 19:12:04,545", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Search companies | filters={'q': 'Jaruwan', 'is_active': True} | limit=50 offset=0"}
{"asctime": "2026-02-15 23:17:19,738", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [POST] Create company request received: string"}
{"asctime": "2026-02-15 23:17:20,778", "levelname": "ERROR", "name": "service.company", "message": "companies.create: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.CheckViolationError'>: new row for relation \"companies\" violates check constraint \"ckc_company_type_companies\"\nDETAIL:  Failing row contains (string, string, string, string, string, string, string, string, string, string, string, string, string, string, string, string, 0.00, string, f, t, 2026-02-15 16:17:20.681228+00, string, 2026-02-15 16:17:20.681228+00, string).\n[SQL: INSERT INTO companies (company_code, company_name, company_name_en, address_line1, address_line2, address_line3, address_line1_en, address_line2_en, address_line3_en, post_code, description, telephone, fax, email, domain_name, tax_id, vat_rate, branch_id, branch_name, head_office, is_active, company_type) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::VARCHAR, $13::VARCHAR, $14::VARCHAR, $15::VARCHAR, $16::VARCHAR, $17::FLOAT, $18::VARCHAR, $19::VARCHAR, $20::BOOLEAN, $21::BOOLEAN, $22::VARCHAR) RETURNING companies.created_at, companies.updated_at]\n[parameters: ('string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 0.0, 'string', 'string', False, True, 'string')]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)", "exc_info": "Traceback (most recent call last):\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 534, in _prepare_and_execute\n    self._rows = deque(await prepared_stmt.fetch(*parameters))\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/asyncpg/prepared_stmt.py\", line 176, in fetch\n    data = await self.__bind_execute(args, 0, timeout)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/asyncpg/prepared_stmt.py\", line 267, in __bind_execute\n    data, status, _ = await self.__do_execute(\n                      ^^^^^^^^^^^^^^^^^^^^^^^^\n        lambda protocol: protocol.bind_execute(\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n            self._state, args, '', limit, True, timeout))\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/asyncpg/prepared_stmt.py\", line 256, in __do_execute\n    return await executor(protocol)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"asyncpg/protocol/protocol.pyx\", line 206, in bind_execute\nasyncpg.exceptions.CheckViolationError: new row for relation \"companies\" violates check constraint \"ckc_company_type_companies\"\nDETAIL:  Failing row contains (string, string, string, string, string, string, string, string, string, string, string, string, string, string, string, string, 0.00, string, f, t, 2026-02-15 16:17:20.681228+00, string, 2026-02-15 16:17:20.681228+00, string).\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 568, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 546, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 497, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 780, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.CheckViolationError'>: new row for relation \"companies\" violates check constraint \"ckc_company_type_companies\"\nDETAIL:  Failing row contains (string, string, string, string, string, string, string, string, string, string, string, string, string, string, string, string, 0.00, string, f, t, 2026-02-15 16:17:20.681228+00, string, 2026-02-15 16:17:20.681228+00, string).\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/jaruwan/Library/Mobile Documents/com~apple~CloudDocs/Projects/TH-WelnessSystems full update/app/utils/router_helpers.py\", line 101, in run_or_500\n    return await result\n           ^^^^^^^^^^^^\n  File \"/Users/jaruwan/Library/Mobile Documents/com~apple~CloudDocs/Projects/TH-WelnessSystems full update/app/api/v1/settings/companies.py\", line 84, in _work\n    obj = await orm_create_company(session, data)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/jaruwan/Library/Mobile Documents/com~apple~CloudDocs/Projects/TH-WelnessSystems full update/app/api/v1/services/settings_orm_service.py\", line 86, in orm_create_company\n    return await _create_model(session, Company, data)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/jaruwan/Library/Mobile Documents/com~apple~CloudDocs/Projects/TH-WelnessSystems full update/app/api/v1/services/settings_orm_service.py\", line 79, in _create_model\n    return await _create(session, obj)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/jaruwan/Library/Mobile Documents/com~apple~CloudDocs/Projects/TH-WelnessSystems full update/app/api/v1/services/settings_orm_service.py\", line 45, in _create\n    await session.commit()\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py\", line 1009, in commit\n    await greenlet_spawn(self.sync_session.commit)\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 203, in greenlet_spawn\n    result = context.switch(value)\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n    ~~~~~~~~~~~~^^^^^^^^^^^^^^^\n  File \"<string>\", line 2, in commit\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n    ~~~~~~~~~~~^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n    ~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n    ~~~~~~~~~~~^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self.mapper,\n        ^^^^^^^^^^^^\n        uow.states_for_mapper_hierarchy(self.mapper, False, False),\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        uow,\n        ^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        base_mapper,\n        ^^^^^^^^^^^^\n    ...<3 lines>...\n        insert,\n        ^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n        statement,\n        params,\n        execution_options=execution_options,\n    )\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n        self,\n        distilled_parameters,\n        execution_options or NO_OPTIONS,\n    )\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self, distilled_params, execution_options\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n        dialect,\n    ...<8 lines>...\n        cache_hit=cache_hit,\n    )\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~^\n        dialect, context, statement, parameters\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        e, str_statement, effective_parameters, cursor, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 568, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 546, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 497, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 780, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.CheckViolationError'>: new row for relation \"companies\" violates check constraint \"ckc_company_type_companies\"\nDETAIL:  Failing row contains (string, string, string, string, string, string, string, string, string, string, string, string, string, string, string, string, 0.00, string, f, t, 2026-02-15 16:17:20.681228+00, string, 2026-02-15 16:17:20.681228+00, string).\n[SQL: INSERT INTO companies (company_code, company_name, company_name_en, address_line1, address_line2, address_line3, address_line1_en, address_line2_en, address_line3_en, post_code, description, telephone, fax, email, domain_name, tax_id, vat_rate, branch_id, branch_name, head_office, is_active, company_type) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::VARCHAR, $13::VARCHAR, $14::VARCHAR, $15::VARCHAR, $16::VARCHAR, $17::FLOAT, $18::VARCHAR, $19::VARCHAR, $20::BOOLEAN, $21::BOOLEAN, $22::VARCHAR) RETURNING companies.created_at, companies.updated_at]\n[parameters: ('string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 'string', 0.0, 'string', 'string', False, True, 'string')]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"asctime": "2026-02-16 19:40:17,845", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Search companies | filters={'q': '', 'is_active': True} | limit=50 offset=0"}
{"asctime": "2026-02-16 19:40:18,498", "levelname": "ERROR", "name": "service.company", "message": "companies.search: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DuplicatePreparedStatementError'>: prepared statement \"__asyncpg_stmt_2__\" already exists\nHINT:  \nNOTE: pgbouncer with pool_mode set to \"transaction\" or\n\"statement\" does not support prepared statements properly.\nYou have two options:\n\n* if you are using pgbouncer for connection pooling to a\n  single server, switch to the connection pool functionality\n  provided by asyncpg, it is a much better option for this\n  purpose;\n\n* if you have no option of avoiding the use of pgbouncer,\n  then you can set statement_cache_size to 0 when creating\n  the asyncpg connection object.\n\n[SQL: select pg_catalog.version()]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "exc_info": "Traceback (most recent call last):\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 510, in _prepare_and_execute\n    prepared_stmt, attributes = await adapt_connection._prepare(\n                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, self._invalidate_schema_cache_asof\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 756, in _prepare\n    prepared_stmt = await self._connection.prepare(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        operation, name=self._prepared_statement_name_func()\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/asyncpg/connection.py\", line 635, in prepare\n    return await self._prepare(\n           ^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/asyncpg/connection.py\", line 653, in _prepare\n    stmt = await self._get_statement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/asyncpg/connection.py\", line 432, in _get_statement\n    statement = await self._protocol.prepare(\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<5 lines>...\n    )\n    ^\n  File \"asyncpg/protocol/protocol.pyx\", line 165, in prepare\nasyncpg.exceptions.DuplicatePreparedStatementError: prepared statement \"__asyncpg_stmt_2__\" already exists\nHINT:  \nNOTE: pgbouncer with pool_mode set to \"transaction\" or\n\"statement\" does not support prepared statements properly.\nYou have two options:\n\n* if you are using pgbouncer for connection pooling to a\n  single server, switch to the connection pool functionality\n  provided by asyncpg, it is a much better option for this\n  purpose;\n\n* if you have no option of avoiding the use of pgbouncer,\n  then you can set statement_cache_size to 0 when creating\n  the asyncpg connection object.\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 568, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 546, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 497, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 780, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.DuplicatePreparedStatementError'>: prepared statement \"__asyncpg_stmt_2__\" already exists\nHINT:  \nNOTE: pgbouncer with pool_mode set to \"transaction\" or\n\"statement\" does not support prepared statements properly.\nYou have two options:\n\n* if you are using pgbouncer for connection pooling to a\n  single server, switch to the connection pool functionality\n  provided by asyncpg, it is a much better option for this\n  purpose;\n\n* if you have no option of avoiding the use of pgbouncer,\n  then you can set statement_cache_size to 0 when creating\n  the asyncpg connection object.\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/Users/jaruwan/Library/Mobile Documents/com~apple~CloudDocs/Projects/TH-WelnessSystems full update/app/utils/router_helpers.py\", line 101, in run_or_500\n    return await result\n           ^^^^^^^^^^^^\n  File \"/Users/jaruwan/Library/Mobile Documents/com~apple~CloudDocs/Projects/TH-WelnessSystems full update/app/api/v1/settings/companies.py\", line 164, in _work\n    total = int((await session.execute(count_stmt)).scalar_one() or 0)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py\", line 461, in execute\n    result = await greenlet_spawn(\n             ^^^^^^^^^^^^^^^^^^^^^\n    ...<6 lines>...\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 203, in greenlet_spawn\n    result = context.switch(value)\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 2362, in execute\n    return self._execute_internal(\n           ~~~~~~~~~~~~~~~~~~~~~~^\n        statement,\n        ^^^^^^^^^^\n    ...<4 lines>...\n        _add_event=_add_event,\n        ^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 2237, in _execute_internal\n    conn = self._connection_for_bind(bind)\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 2106, in _connection_for_bind\n    return trans._connection_for_bind(engine, execution_options)\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"<string>\", line 2, in _connection_for_bind\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/orm/session.py\", line 1189, in _connection_for_bind\n    conn = bind.connect()\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 3278, in connect\n    return self._connection_cls(self)\n           ~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 146, in __init__\n    self._dbapi_connection = engine.raw_connection()\n                             ~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 3302, in raw_connection\n    return self.pool.connect()\n           ~~~~~~~~~~~~~~~~~^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/pool/base.py\", line 449, in connect\n    return _ConnectionFairy._checkout(self)\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/pool/base.py\", line 1263, in _checkout\n    fairy = _ConnectionRecord.checkout(pool)\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/pool/base.py\", line 712, in checkout\n    rec = pool._do_get()\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/pool/impl.py\", line 179, in _do_get\n    with util.safe_reraise():\n         ~~~~~~~~~~~~~~~~~^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/pool/impl.py\", line 177, in _do_get\n    return self._create_connection()\n           ~~~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/pool/base.py\", line 390, in _create_connection\n    return _ConnectionRecord(self)\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/pool/base.py\", line 674, in __init__\n    self.__connect()\n    ~~~~~~~~~~~~~~^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/pool/base.py\", line 914, in __connect\n    )._exec_w_sync_on_first_run(self.dbapi_connection, self)\n      ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/event/attr.py\", line 483, in _exec_w_sync_on_first_run\n    self(*args, **kw)\n    ~~~~^^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/event/attr.py\", line 497, in __call__\n    fn(*args, **kw)\n    ~~^^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py\", line 1912, in go\n    return once_fn(*arg, **kw)\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/create.py\", line 749, in first_connect\n    dialect.initialize(c)\n    ~~~~~~~~~~~~~~~~~~^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/base.py\", line 3114, in initialize\n    super().initialize(connection)\n    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 519, in initialize\n    self.server_version_info = self._get_server_version_info(\n                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        connection\n        ^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/base.py\", line 3382, in _get_server_version_info\n    v = connection.exec_driver_sql(\"select pg_catalog.version()\").scalar()\n        ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1779, in exec_driver_sql\n    ret = self._execute_context(\n        dialect,\n    ...<5 lines>...\n        distilled_parameters,\n    )\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~^\n        dialect, context, statement, parameters\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        e, str_statement, effective_parameters, cursor, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n    ~~~~~~~~~~~~~~~~~~~~~~~^\n        cursor, str_statement, effective_parameters, context\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 568, in execute\n    self._adapt_connection.await_(\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        self._prepare_and_execute(operation, parameters)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 546, in _prepare_and_execute\n    self._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 497, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^\n  File \"/Users/jaruwan/fastapi-practice/fastapi-env/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 780, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DuplicatePreparedStatementError'>: prepared statement \"__asyncpg_stmt_2__\" already exists\nHINT:  \nNOTE: pgbouncer with pool_mode set to \"transaction\" or\n\"statement\" does not support prepared statements properly.\nYou have two options:\n\n* if you are using pgbouncer for connection pooling to a\n  single server, switch to the connection pool functionality\n  provided by asyncpg, it is a much better option for this\n  purpose;\n\n* if you have no option of avoiding the use of pgbouncer,\n  then you can set statement_cache_size to 0 when creating\n  the asyncpg connection object.\n\n[SQL: select pg_catalog.version()]\n(Background on this error at: https://sqlalche.me/e/20/f405)"}
{"asctime": "2026-02-16 19:45:36,159", "levelname": "INFO", "name": "service.company", "message": "\ud83d\udce5 [GET] Search companies | filters={'q': '', 'is_active': True} | limit=50 offset=0"}
